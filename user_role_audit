-- Danh sách tất cả users
SELECT username, account_status, created, lock_date, expiry_date, profile, default_tablespace
FROM dba_users
ORDER BY username;

-- Tất cả roles trong database
SELECT role, password_required, authentication_type
FROM dba_roles
ORDER BY role;

-- Roles được tạo bởi user (không phải system roles)
SELECT role, password_required
FROM dba_roles
WHERE role NOT IN ('CONNECT', 'RESOURCE', 'DBA', 'SELECT_CATALOG_ROLE')
ORDER BY role;

-- Roles được gán cho từng user
SELECT grantee AS username, granted_role, admin_option, default_role
FROM dba_role_privs
WHERE grantee IN (SELECT username FROM dba_users)
ORDER BY grantee, granted_role;

-- Roles của một user cụ thể
SELECT grantee, granted_role, admin_option, default_role
FROM dba_role_privs
WHERE grantee = 'YOUR_USERNAME'
ORDER BY granted_role;

-- Users có role DBA
SELECT grantee, admin_option
FROM dba_role_privs
WHERE granted_role = 'DBA'
AND grantee IN (SELECT username FROM dba_users);

-- System privileges trực tiếp cho users
SELECT grantee, privilege, admin_option
FROM dba_sys_privs
WHERE grantee IN (SELECT username FROM dba_users)
ORDER BY grantee, privilege;

-- System privileges của một user cụ thể
SELECT privilege, admin_option
FROM dba_sys_privs
WHERE grantee = 'YOUR_USERNAME'
ORDER BY privilege;

-- Tất cả system privileges của user (trực tiếp + từ roles)
SELECT privilege, 'DIRECT' AS source
FROM dba_sys_privs
WHERE grantee = 'YOUR_USERNAME'
UNION
SELECT privilege, 'VIA ROLE: ' || granted_role AS source
FROM dba_sys_privs sp
JOIN dba_role_privs rp ON sp.grantee = rp.granted_role
WHERE rp.grantee = 'YOUR_USERNAME'
ORDER BY privilege;

-- Lần đăng nhập gần nhất của users
SELECT username, MAX(timestamp) AS last_login
FROM dba_audit_trail
WHERE action_name = 'xxx'
GROUP BY username
ORDER BY last_login DESC;

